import { FieldHook } from 'payload';

/**
 * Хук для форматирования визуальных тегов перед сохранением.
 * Преобразует строку с тегами, разделенными пробелами, точками или другими символами,
 * в строку с тегами, разделенными запятой с пробелом.
 * Примеры входных данных:
 * 'Мрачный•Напряжённый•Юмористический'
 * 'Мрачный,Напряжённый,Юмористический'
 * 'Мрачный Напряжённый Юмористический'
 */
export const formatVisualTags: FieldHook = ({ value }) => {
  if (typeof value === 'string') {
    // Разделяем строку по •, запятой или пробелу (одному или нескольким)
    const elements = value.split(/[•, ]+/);

    // Очищаем пустые элементы и пробелы на концах
    const tags = elements
      .map((tag) => tag.trim())
      .filter((tag) => tag.length > 0);

    // Собираем обратно через запятую
    return tags.join(', ');
  }

  return value;
};
